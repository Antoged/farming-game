<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåæ Farming Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
        }

        .weather-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tab.active {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .content {
            min-height: 400px;
        }

        .farm-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .plot {
            aspect-ratio: 1;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .plot:hover {
            background: var(--tg-theme-hint-color, #999999);
        }

        .plot.planted {
            background: #4CAF50;
            color: white;
        }

        .plot.ready {
            background: #FF9800;
            color: white;
            animation: pulse 1s infinite;
        }

        .plot-info {
            font-size: 12px;
            text-align: center;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .shop-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .shop-item button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
        }

        .inventory-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .inventory-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .inventory-item button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #999999);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .error {
            color: #f44336;
            text-align: center;
            padding: 20px;
        }

        .success {
            color: #4CAF50;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåæ –§–µ—Ä–º–µ—Ä—Å–∫–∞—è –ò–≥—Ä–∞</h1>
        <div id="mode-info" style="font-size: 12px; opacity: 0.8; margin-bottom: 10px;"></div>
        <div class="weather-info">
            <span id="weather-emoji">üå§Ô∏è</span>
            <span id="weather-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã...</span>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div>üí∞ –ú–æ–Ω–µ—Ç—ã</div>
            <div id="money">0</div>
        </div>
        <div class="stat-card">
            <div>üìä –£—Ä–æ–≤–µ–Ω—å</div>
            <div id="level">1</div>
        </div>
        <div class="stat-card">
            <div>üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <div id="inventory-count">0</div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('farm')">üå± –§–µ—Ä–º–∞</div>
        <div class="tab" onclick="switchTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="tab" onclick="switchTab('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
    </div>

    <div class="content">
        <!-- –§–µ—Ä–º–∞ -->
        <div id="farm-content" class="tab-content">
            <div class="farm-grid" id="farm-grid">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–µ—Ä–º—ã...</div>
            </div>
        </div>

        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div id="shop-content" class="tab-content" style="display: none;">
            <div class="shop-items" id="shop-items">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞...</div>
            </div>
        </div>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory-content" class="tab-content" style="display: none;">
            <div class="inventory-items" id="inventory-items">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...</div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ user_id –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        console.log('=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –§–ï–†–ú–ï–†–°–ö–û–ô –ò–ì–†–´ ===');
        console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage...');
        
        let userId = localStorage.getItem('farming_game_user_id');
        console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π userId –∏–∑ localStorage:', userId);
        
        // –ï—Å–ª–∏ ID –µ—â–µ –Ω–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        if (!userId) {
            console.log('userId –Ω–µ –Ω–∞–π–¥–µ–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π...');
            
            try {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏, —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏ —Ö–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞
                const browserFingerprint = navigator.userAgent.length + screen.width + screen.height;
                userId = 'user_' + Date.now() + '_' + Math.floor(Math.random() * 10000) + '_' + (browserFingerprint % 1000);
                
                console.log('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π userId:', userId);
                console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage...');
                
                localStorage.setItem('farming_game_user_id', userId);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
                const savedUserId = localStorage.getItem('farming_game_user_id');
                console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π userId:', savedUserId);
                
                if (savedUserId !== userId) {
                    throw new Error('localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                }
                
                console.log('‚úÖ userId —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                
            } catch (error) {
                console.error('‚ùå –û–®–ò–ë–ö–ê –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ userId:', error);
                userId = 'fallback_' + Math.random().toString(36).substr(2, 9);
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º fallback userId:', userId);
            }
        } else {
            console.log('‚úÖ userId –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ localStorage:', userId);
        }
        
        // –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ–º –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        // (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API-—Ä–µ–∂–∏–º –≤ –±—É–¥—É—â–µ–º —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        const isDemoMode = true;

        let currentTab = 'farm';

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            currentTab = tabName;
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-content').style.display = 'block';
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            switch(tabName) {
                case 'farm':
                    loadFarm();
                    break;
                case 'shop':
                    loadShop();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è mock –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö
        function getMockData() {
            console.log('getMockData –≤—ã–∑–≤–∞–Ω–∞ —Å userId:', userId);
            
            if (!userId) {
                console.error('‚ùå –û–®–ò–ë–ö–ê: userId –ø—É—Å—Ç–æ–π –≤ getMockData!');
                return null;
            }
            
            const storageKey = `farming_game_data_${userId}`;
            console.log('–ö–ª—é—á —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:', storageKey);
            
            let mockData = JSON.parse(localStorage.getItem(storageKey) || 'null');
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage:', mockData ? '–Ω–∞–π–¥–µ–Ω—ã' : '–Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ
            if (!mockData) {
                console.log('–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
                mockData = {
                    farm: {
                        plots: [
                            { status: 'empty' },
                            { status: 'planted', timeLeft: 45, seedType: 'carrot' },
                            { status: 'ready', seedType: 'tomato' },
                            { status: 'empty' },
                            { status: 'planted', timeLeft: 120, seedType: 'potato' },
                            { status: 'empty' }
                        ]
                    },
                    shop: {
                        items: [
                            { seed_type: 'carrot', name: '–ú–æ—Ä–∫–æ–≤—å', emoji: 'ü•ï', price: 10 },
                            { seed_type: 'tomato', name: '–ü–æ–º–∏–¥–æ—Ä', emoji: 'üçÖ', price: 25 },
                            { seed_type: 'potato', name: '–ö–∞—Ä—Ç–æ—à–∫–∞', emoji: 'ü•î', price: 15 },
                            { seed_type: 'cucumber', name: '–û–≥—É—Ä–µ—Ü', emoji: 'ü•í', price: 20 }
                        ]
                    },
                    inventory: {
                        items: [
                            { id: 1, item_type: 'carrot', name: '–ú–æ—Ä–∫–æ–≤—å', emoji: 'ü•ï', price: 15, weight: 120, size: 18 },
                            { id: 2, item_type: 'tomato', name: '–ü–æ–º–∏–¥–æ—Ä', emoji: 'üçÖ', price: 35, weight: 180, size: 25 }
                        ]
                    },
                    stats: { money: 150, level: 2, inventory_count: 2 },
                    weather: { type: 'sunny', name: '–°–æ–ª–Ω–µ—á–Ω–æ', emoji: '‚òÄÔ∏è' }
                };
                console.log('–ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã');
                saveMockData(mockData);
                console.log('–ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            }
            
            console.log('–í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ:', mockData ? '—É—Å–ø–µ—à–Ω–æ' : '–æ—à–∏–±–∫–∞');
            return mockData;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è mock –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function saveMockData(data) {
            console.log('saveMockData –≤—ã–∑–≤–∞–Ω–∞ —Å userId:', userId);
            
            if (!userId) {
                console.error('‚ùå –û–®–ò–ë–ö–ê: userId –ø—É—Å—Ç–æ–π –≤ saveMockData!');
                return;
            }
            
            const storageKey = `farming_game_data_${userId}`;
            console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª—é—á—É:', storageKey);
            
            try {
                localStorage.setItem(storageKey, JSON.stringify(data));
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                console.error('‚ùå –û–®–ò–ë–ö–ê —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º mockData...');
        let mockData = getMockData();
        
        if (!mockData) {
            console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!');
            document.body.innerHTML = `
                <div style="padding: 20px; text-align: center; color: red;">
                    <h2>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã</h2>
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
                    <p>–í–æ–∑–º–æ–∂–Ω–æ, localStorage –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; font-size: 16px;">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            `;
        } else {
            console.log('‚úÖ mockData —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–µ—Ä–º—ã
        async function loadFarm() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const farmData = mockData.farm;
                
                const farmGrid = document.getElementById('farm-grid');
                farmGrid.innerHTML = '';
                
                farmData.plots.forEach((plot, index) => {
                    const plotElement = document.createElement('div');
                    plotElement.className = `plot ${plot.status}`;
                    plotElement.onclick = () => handlePlotClick(index);
                    
                    let plotContent = '';
                    if (plot.status === 'empty') {
                        plotContent = 'üå±';
                    } else if (plot.status === 'planted') {
                        plotContent = 'üåø';
                    } else if (plot.status === 'ready') {
                        plotContent = 'üåæ';
                    }
                    
                    plotElement.innerHTML = `
                        <div class="plot-info">
                            ${plotContent}
                            ${plot.status === 'planted' ? `<br><small>${plot.timeLeft || 0}s</small>` : ''}
                        </div>
                    `;
                    
                    farmGrid.appendChild(plotElement);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã:', error);
                document.getElementById('farm-grid').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã</div>';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É—á–∞—Å—Ç–∫—É
        async function handlePlotClick(plotId) {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const plots = { plots: mockData.farm.plots };
                
                const plot = plots.plots[plotId];
                
                if (plot.status === 'empty') {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä —Å–µ–º—è–Ω
                    const seedType = prompt('–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–º–µ–Ω–∞ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏:\n1. –ú–æ—Ä–∫–æ–≤—å\n2. –ü–æ–º–∏–¥–æ—Ä\n3. –ö–∞—Ä—Ç–æ—à–∫–∞\n4. –û–≥—É—Ä–µ—Ü\n5. –ö–ª—É–±–Ω–∏–∫–∞\n6. –ê—Ä–±—É–∑\n7. –ó–æ–ª–æ—Ç–æ–µ —è–±–ª–æ–∫–æ');
                    
                    if (seedType) {
                        const seedMap = {
                            '1': 'carrot', '2': 'tomato', '3': 'potato', '4': 'cucumber',
                            '5': 'strawberry', '6': 'watermelon', '7': 'golden_apple'
                        };
                        
                        if (seedMap[seedType]) {
                            await plantSeed(plotId, seedMap[seedType]);
                        }
                    }
                } else if (plot.status === 'ready') {
                    // –°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π
                    await harvestPlot(plotId);
                }
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—á–∞—Å—Ç–∫–∞');
            }
        }

        // –ü–æ—Å–∞–¥–∫–∞ —Å–µ–º—è–Ω
        async function plantSeed(plotId, seedType) {
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (mockData.farm.plots[plotId].status === 'empty') {
                    mockData.farm.plots[plotId] = {
                        status: 'planted',
                        seedType: seedType,
                        timeLeft: 60 // 1 –º–∏–Ω—É—Ç–∞
                    };
                    saveMockData(mockData); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    tg.showAlert('üå± –°–µ–º–µ–Ω–∞ –ø–æ—Å–∞–∂–µ–Ω—ã!');
                    loadFarm();
                } else {
                    tg.showAlert('‚ùå –£—á–∞—Å—Ç–æ–∫ —É–∂–µ –∑–∞–Ω—è—Ç');
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø–æ—Å–∞–¥–∫–∏');
            }
        }

        // –°–±–æ—Ä —É—Ä–æ–∂–∞—è
        async function harvestPlot(plotId) {
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (mockData.farm.plots[plotId].status === 'ready') {
                    const seedType = mockData.farm.plots[plotId].seedType || 'carrot';
                    
                    // –û—á–∏—â–∞–µ–º —É—á–∞—Å—Ç–æ–∫
                    mockData.farm.plots[plotId] = { status: 'empty' };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                    const newItem = {
                        id: Date.now(),
                        item_type: seedType,
                        name: mockData.shop.items.find(i => i.seed_type === seedType)?.name || '–£—Ä–æ–∂–∞–π',
                        emoji: mockData.shop.items.find(i => i.seed_type === seedType)?.emoji || 'üå±',
                        price: Math.floor(Math.random() * 30) + 15,
                        weight: Math.floor(Math.random() * 100) + 50,
                        size: Math.floor(Math.random() * 20) + 10
                    };
                    
                    mockData.inventory.items.push(newItem);
                    mockData.stats.inventory_count = mockData.inventory.items.length;
                    mockData.stats.money += 5; // –ë–æ–Ω—É—Å –∑–∞ —Å–±–æ—Ä
                    
                    saveMockData(mockData); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    tg.showAlert('üåæ –£—Ä–æ–∂–∞–π —Å–æ–±—Ä–∞–Ω!');
                    loadFarm();
                    updateStats();
                } else {
                    tg.showAlert('‚ùå –£—Ä–æ–∂–∞–π –Ω–µ –≥–æ—Ç–æ–≤');
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ —É—Ä–æ–∂–∞—è');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        async function loadShop() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const shopData = mockData.shop;
                
                const shopItems = document.getElementById('shop-items');
                shopItems.innerHTML = '';
                
                shopData.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'shop-item';
                    itemElement.innerHTML = `
                        <div>${item.emoji} ${item.name}</div>
                        <div>üí∞ ${item.price}</div>
                        <button onclick="buySeed('${item.seed_type}')">–ö—É–ø–∏—Ç—å</button>
                    `;
                    shopItems.appendChild(itemElement);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞:', error);
                document.getElementById('shop-items').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</div>';
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ —Å–µ–º—è–Ω
        async function buySeed(seedType) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–Ω—å–≥–∏ –∏ –ø–æ–∫—É–ø–∞–µ–º —Å–µ–º–µ–Ω–∞
                const seed = mockData.shop.items.find(item => item.seed_type === seedType);
                if (seed && mockData.stats.money >= seed.price) {
                    mockData.stats.money -= seed.price;
                    saveMockData(mockData); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    tg.showAlert(`üå± ${seed.name} –∫—É–ø–ª–µ–Ω—ã –∑–∞ ${seed.price} –º–æ–Ω–µ—Ç!`);
                    updateStats();
                } else if (seed) {
                    tg.showAlert(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥! –ù—É–∂–Ω–æ: ${seed.price}, —É –≤–∞—Å: ${mockData.stats.money}`);
                } else {
                    tg.showAlert('‚ùå –°–µ–º–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        async function loadInventory() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const inventoryData = mockData.inventory;
                
                const inventoryItems = document.getElementById('inventory-items');
                inventoryItems.innerHTML = '';
                
                if (inventoryData.items.length === 0) {
                    inventoryItems.innerHTML = '<div class="loading">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                    return;
                }
                
                inventoryData.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.innerHTML = `
                        <div>${item.emoji} ${item.name}</div>
                        <div>üí∞ ${item.price}</div>
                        <div>üìè ${item.weight}–≥, ${item.size}—Å–º</div>
                        <button onclick="sellItem(${item.id})">–ü—Ä–æ–¥–∞—Ç—å</button>
                    `;
                    inventoryItems.appendChild(itemElement);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è:', error);
                document.getElementById('inventory-items').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</div>';
            }
        }

        // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
        async function sellItem(itemId) {
            try {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const item = mockData.inventory.items.find(item => item.id === itemId);
                if (item) {
                    mockData.inventory.items = mockData.inventory.items.filter(item => item.id !== itemId);
                    mockData.stats.money += item.price; // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–Ω—å–≥–∏ –ø–æ —Ü–µ–Ω–µ –ø—Ä–µ–¥–º–µ—Ç–∞
                    mockData.stats.inventory_count = mockData.inventory.items.length;
                    
                    saveMockData(mockData); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    tg.showAlert('üí∞ –ü—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–¥–∞–Ω!');
                    loadInventory();
                    updateStats();
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–¥–∞–∂–∏');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function updateStats() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const stats = mockData.stats;
                
                document.getElementById('money').textContent = stats.money || 100;
                document.getElementById('level').textContent = stats.level || 1;
                document.getElementById('inventory-count').textContent = stats.inventory_count || 0;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                document.getElementById('money').textContent = '100';
                document.getElementById('level').textContent = '1';
                document.getElementById('inventory-count').textContent = '0';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        async function updateWeather() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const weather = mockData.weather;
                
                const emoji = {
                    'sunny': '‚òÄÔ∏è',
                    'rainy': 'üåßÔ∏è',
                    'cloudy': '‚òÅÔ∏è',
                    'stormy': '‚õàÔ∏è',
                    'normal': 'üå§Ô∏è'
                }[weather.type] || 'üå§Ô∏è';
                
                document.getElementById('weather-emoji').textContent = weather.emoji || emoji;
                document.getElementById('weather-text').textContent = weather.name || '–û–±—ã—á–Ω–∞—è –ø–æ–≥–æ–¥–∞';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                document.getElementById('weather-emoji').textContent = 'üå§Ô∏è';
                document.getElementById('weather-text').textContent = '–û–±—ã—á–Ω–∞—è –ø–æ–≥–æ–¥–∞';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∂–∏–º–µ
        function updateModeInfo() {
            const modeInfo = document.getElementById('mode-info');
            const resetButton = '<button onclick="resetDemoData()" style="background:none;border:none;color:inherit;text-decoration:underline;cursor:pointer;font-size:10px;margin-left:10px;">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>';
            const shortId = userId.length > 25 ? userId.slice(0, 25) + '...' : userId;
            modeInfo.innerHTML = `üéÆ –ò–≥—Ä–æ–≤–æ–π ID: ${shortId}${resetButton}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –∏–≥—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function resetDemoData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
                const storageKey = `farming_game_data_${userId}`;
                localStorage.removeItem(storageKey);
                mockData = getMockData(); // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                loadFarm();
                updateWeather();
                updateStats();
                if (currentTab === 'shop') loadShop();
                if (currentTab === 'inventory') loadInventory();
                
                tg.showAlert('üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞!');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã —Å userId:', userId);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ userId –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
        if (!userId) {
            console.error('–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: userId –Ω–µ –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
            document.body.innerHTML = `
                <div style="padding: 20px; text-align: center; color: red;">
                    <h2>‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–∞.</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; font-size: 16px;">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            `;
            return;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
        updateModeInfo();
        loadFarm();
        updateWeather();
        updateStats();

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (currentTab === 'farm') {
                loadFarm();
            }
            updateWeather();
            updateStats();
        }, 30000);
    </script>
</body>
</html>

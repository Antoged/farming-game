<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ—Ä–º–µ—Ä—Å–∫–∞—è –∏–≥—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
        }

        .weather-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tab.active {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .content {
            min-height: 400px;
        }

        .farm-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .plot {
            aspect-ratio: 1;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .plot:hover {
            background: var(--tg-theme-hint-color, #999999);
        }

        .plot.planted {
            background: #4CAF50;
            color: white;
        }

        .plot.ready {
            background: #FF9800;
            color: white;
        }

        .shop-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .buy-btn {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .inventory-item {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sell-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #999999);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåæ –§–µ—Ä–º–µ—Ä—Å–∫–∞—è –∏–≥—Ä–∞</h1>
        <div class="weather-info">
            <span id="weather-emoji">üå§Ô∏è</span>
            <span id="weather-text">–ü–æ–≥–æ–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div>üí∞ –î–µ–Ω—å–≥–∏</div>
            <div id="money">100</div>
        </div>
        <div class="stat-card">
            <div>üå± –£—Ä–æ–≤–µ–Ω—å</div>
            <div id="level">1</div>
        </div>
        <div class="stat-card">
            <div>üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <div id="inventory-count">0</div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('farm')">üè† –§–µ—Ä–º–∞</div>
        <div class="tab" onclick="switchTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="tab" onclick="switchTab('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
    </div>

    <div class="content">
        <!-- –§–µ—Ä–º–∞ -->
        <div id="farm-content">
            <div class="farm-grid" id="farm-grid">
                <!-- –ü–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div id="shop-content" class="hidden">
            <div id="shop-items">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞...</div>
            </div>
        </div>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory-content" class="hidden">
            <div id="inventory-items">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...</div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –ü–æ–ª—É—á–µ–Ω–∏–µ user_id –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentTab = 'farm';
        let farmData = null;
        let shopData = null;
        let inventoryData = null;

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tab) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
            event.target.classList.add('active');

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã
            document.querySelectorAll('.content > div').forEach(c => c.classList.add('hidden'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            document.getElementById(tab + '-content').classList.remove('hidden');
            
            currentTab = tab;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            switch(tab) {
                case 'farm':
                    loadFarm();
                    break;
                case 'shop':
                    loadShop();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–µ—Ä–º—ã
        async function loadFarm() {
            try {
                const response = await fetch(`https://your-github-username.github.io/your-repo/api/farm?user_id=${userId}`);
                const data = await response.json();
                farmData = data;
                renderFarm();
                updateStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã:', error);
                renderFarmError();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–µ—Ä–º—ã
        function renderFarm() {
            const grid = document.getElementById('farm-grid');
            grid.innerHTML = '';

            if (!farmData || !farmData.farm) {
                grid.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–µ—Ä–º—ã...</div>';
                return;
            }

            for (let i = 0; i < 9; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.onclick = () => handlePlotClick(i);

                const plotData = farmData.farm.find(p => p.plot_id === i);
                
                if (plotData) {
                    if (plotData.is_ready) {
                        plot.classList.add('ready');
                        plot.textContent = 'üåæ';
                    } else {
                        plot.classList.add('planted');
                        plot.textContent = 'üå±';
                    }
                } else {
                    plot.textContent = '‚¨ú';
                }

                grid.appendChild(plot);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É—á–∞—Å—Ç–∫—É
        async function handlePlotClick(plotId) {
            const plotData = farmData.farm.find(p => p.plot_id === plotId);
            
            if (!plotData) {
                // –°–∞–∂–∞–µ–º —Å–µ–º–µ—á–∫–æ
                showSeedSelection(plotId);
            } else if (plotData.is_ready) {
                // –°–æ–±–∏—Ä–∞–µ–º —É—Ä–æ–∂–∞–π
                await harvestPlot(plotId);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä —Å–µ–º–µ—á–∫–∞
        function showSeedSelection(plotId) {
            const seeds = [
                { type: 'carrot', name: 'ü•ï –ú–æ—Ä–∫–æ–≤—å', price: 10 },
                { type: 'tomato', name: 'üçÖ –ü–æ–º–∏–¥–æ—Ä', price: 20 },
                { type: 'potato', name: 'ü•î –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', price: 15 }
            ];

            const message = seeds.map(s => `${s.name} - ${s.price} –º–æ–Ω–µ—Ç`).join('\n');
            tg.showAlert(`–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–º–µ—á–∫–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏:\n\n${message}`, () => {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞
                plantSeed(plotId, 'carrot');
            });
        }

        // –ü–æ—Å–∞–¥–∏—Ç—å —Å–µ–º–µ—á–∫–æ
        async function plantSeed(plotId, seedType) {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/plant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        plot_id: plotId,
                        seed_type: seedType
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    tg.showAlert('üå± –°–µ–º–µ—á–∫–æ –ø–æ—Å–∞–∂–µ–Ω–æ!');
                    loadFarm();
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø–æ—Å–∞–¥–∫–∏');
            }
        }

        // –°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π
        async function harvestPlot(plotId) {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/harvest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        plot_id: plotId
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    tg.showAlert('üåæ –£—Ä–æ–∂–∞–π —Å–æ–±—Ä–∞–Ω!');
                    loadFarm();
                    loadInventory();
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ —É—Ä–æ–∂–∞—è');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        async function loadShop() {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/shop');
                const data = await response.json();
                shopData = data;
                renderShop();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞:', error);
                renderShopError();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        function renderShop() {
            const container = document.getElementById('shop-items');
            
            if (!shopData || !shopData.items || shopData.items.length === 0) {
                container.innerHTML = '<div class="loading">–ú–∞–≥–∞–∑–∏–Ω –ø—É—Å—Ç</div>';
                return;
            }

            container.innerHTML = shopData.items.map(item => `
                <div class="shop-item">
                    <div>
                        <div>${item.name}</div>
                        <div style="font-size: 12px; color: var(--tg-theme-hint-color);">
                            –í—Ä–µ–º—è —Ä–æ—Å—Ç–∞: ${item.growth_time} —Å–µ–∫
                        </div>
                    </div>
                    <div>
                        <span style="margin-right: 8px;">üí∞ ${item.price}</span>
                        <button class="buy-btn" onclick="buySeed('${item.seed_type}')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü–æ–∫—É–ø–∫–∞ —Å–µ–º–µ—á–∫–∞
        async function buySeed(seedType) {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/buy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        seed_type: seedType
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    tg.showAlert('‚úÖ –°–µ–º–µ—á–∫–æ –∫—É–ø–ª–µ–Ω–æ!');
                    updateStats();
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        async function loadInventory() {
            try {
                const response = await fetch(`https://your-github-username.github.io/your-repo/api/inventory?user_id=${userId}`);
                const data = await response.json();
                inventoryData = data;
                renderInventory();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è:', error);
                renderInventoryError();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function renderInventory() {
            const container = document.getElementById('inventory-items');
            
            if (!inventoryData || !inventoryData.items || inventoryData.items.length === 0) {
                container.innerHTML = '<div class="loading">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                return;
            }

            container.innerHTML = inventoryData.items.map(item => `
                <div class="inventory-item">
                    <div>
                        <div>${item.name}</div>
                        <div style="font-size: 12px; color: var(--tg-theme-hint-color);">
                            –í–µ—Å: ${item.weight}g, –†–∞–∑–º–µ—Ä: ${item.size}cm, –ö–∞—á–µ—Å—Ç–≤–æ: ${item.quality}
                        </div>
                    </div>
                    <div>
                        <span style="margin-right: 8px;">üí∞ ${item.price}</span>
                        <button class="sell-btn" onclick="sellItem(${item.id})">–ü—Ä–æ–¥–∞—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
        async function sellItem(itemId) {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/sell', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        item_id: itemId
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    tg.showAlert('üí∞ –ü—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–¥–∞–Ω!');
                    loadInventory();
                    updateStats();
                } else {
                    tg.showAlert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                tg.showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–¥–∞–∂–∏');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function updateStats() {
            try {
                const response = await fetch(`https://your-github-username.github.io/your-repo/api/stats?user_id=${userId}`);
                const stats = await response.json();
                
                document.getElementById('money').textContent = stats.money;
                document.getElementById('level').textContent = stats.level;
                document.getElementById('inventory-count').textContent = stats.inventory_count;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        async function updateWeather() {
            try {
                const response = await fetch('https://your-github-username.github.io/your-repo/api/weather');
                const weather = await response.json();
                
                const emoji = {
                    'sunny': '‚òÄÔ∏è',
                    'rainy': 'üåßÔ∏è',
                    'cloudy': '‚òÅÔ∏è',
                    'stormy': '‚õàÔ∏è',
                    'normal': 'üå§Ô∏è'
                }[weather.type] || 'üå§Ô∏è';
                
                document.getElementById('weather-emoji').textContent = emoji;
                document.getElementById('weather-text').textContent = weather.name;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        function renderFarmError() {
            document.getElementById('farm-grid').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã</div>';
        }

        function renderShopError() {
            document.getElementById('shop-items').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</div>';
        }

        function renderInventoryError() {
            document.getElementById('inventory-items').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</div>';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        if (userId) {
            loadFarm();
            updateWeather();
            updateStats();
        } else {
            document.body.innerHTML = '<div class="loading">–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω user_id</div>';
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (currentTab === 'farm') {
                loadFarm();
            }
            updateWeather();
            updateStats();
        }, 30000);
    </script>
</body>
</html>
